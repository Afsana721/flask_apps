<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AptiCraft Dev Console & Products</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Three.js for 3D simulation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    
    <!-- Custom config for font and colors (Updated for Sleek Dark Theme) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Deep Navy/Midnight Blue Background
                        'dark-bg': '#0a192f', 
                        // Card background color - slightly lighter navy
                        'dark-card': '#112240',
                        // Primary corporate color (Vibrant Teal/Cyan)
                        'corp-primary': '#00FFFF', 
                        // Secondary accent (Mint Green)
                        'corp-secondary': '#64ffda', 
                        'header-bg': '#112240',
                        // Almost black for code blocks
                        'code-bg': '#000a1a', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <!-- Custom styles for the code blocks and canvas (Updated for Dark Theme) -->
    <style>
        body {
            /* Smooth background gradient for depth */
            background-color: #0a192f;
        }
        .code-output {
            /* Code block styling */
            background-color: var(--code-bg);
            border: 1px solid #1f365d; /* Dark border */
            border-left: 5px solid var(--code-border-color, #00FFFF);
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            min-height: 100px;
            color: #64ffda; /* Mint green text for code */
        }
        /* Style for the active IDE tab */
        .tab-active {
            background-color: #00FFFF;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            color: #0a192f; /* Dark text on bright tab */
        }
        /* Fixed height for the canvas container */
        #simulation-container {
            height: 300px; 
            width: 100%;
            background-color: #000a1a; /* Very dark background for the sim */
        }
        
    </style>
<style id="ux3d">
  /* Subtle aurora glow + 3D tilt */
  .aurora:before{content:"";position:absolute;inset:-25%;background:radial-gradient(45% 35% at 20% 20%,rgba(0,255,255,.10),transparent 60%),radial-gradient(50% 40% at 80% 10%,rgba(100,255,218,.08),transparent 60%),radial-gradient(55% 45% at 50% 90%,rgba(168,85,247,.07),transparent 60%);filter:blur(40px);z-index:-1;animation:aur 16s linear infinite}
  @keyframes aur{0%{transform:translate3d(0,0,0) rotate(0)}50%{transform:translate3d(2%,-1%,0) rotate(12deg)}100%{transform:translate3d(0,0,0) rotate(0)}}
  .product-card{transform-style:preserve-3d}
</style>
</head>

<body class="bg-dark-bg text-gray-100 font-sans min-h-screen pb-20">

    <!-- Header Section -->
    <header class="bg-header-bg p-4 shadow-xl border-b border-corp-primary/30 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black tracking-widest text-gray-50">
                APTI<span class="text-corp-primary">CRAFT</span>
            </h1>
            <nav>
                <span class="text-xs font-medium text-gray-400">DEVELOPMENT CONSOLE</span>
            </nav>
        </div>
    </header>

    <!-- Main Content Grid -->
    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <h2 class="relative aurora text-4xl font-extrabold mb-8 text-center bg-clip-text text-transparent bg-gradient-to-r from-corp-primary to-corp-secondary drop-shadow-lg">
            Live Diagnostics & Product Showcase
        </h2>
        
        <!-- TOP ROW: 3D Simulation (1/3) and Product Grid (2/3) -->
        <div class="lg:grid lg:grid-cols-3 lg:gap-8">

            <!-- === LEFT COLUMN: 3D SIMULATION === -->
            <aside class="lg:col-span-1 mb-8 lg:mb-0">
                
                <!-- 3D Visualization Canvas -->
                <div class="bg-dark-card border border-corp-primary/30 rounded-xl shadow-2xl p-2 h-full flex flex-col">
                    <h3 class="text-lg font-semibold text-gray-300 p-2 mb-2 border-b border-gray-700">
                        Live Network Simulation (Three.js)
                    </h3>
                    <div id="simulation-container" class="rounded-lg overflow-hidden border border-corp-secondary/30 flex-grow">
                        <!-- Canvas will be appended here -->
                    </div>
                </div>
            </aside>

            <!-- === RIGHT COLUMN: PRODUCT GRID (6 items, 3 columns) === -->
            <section id="features-grid" class="lg:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Mock product data for preview (Updated to 6 products) -->
                {% set products = [
    {'id': 101, 'name': 'Quantum Analyzer', 'category': 'Sensors', 'image_url': 'https://images.unsplash.com/photo-1555617117-08fda9f7fd9d?q=80&w=800&auto=format&fit=crop', 'description': 'High-precision sensor array for environmental scanning and anomaly detection.', 'price': 1200.00},
    {'id': 102, 'name': 'Aura Synthesizer', 'category': 'Power & RF', 'image_url': 'https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=800&auto=format&fit=crop', 'description': 'Generates protective energy fields tailored to individual biometrics.', 'price': 750.00},
    {'id': 103, 'name': 'Chrono Delineator', 'category': 'Timing', 'image_url': 'https://images.unsplash.com/photo-1518779578993-ec3579fee39f?q=80&w=800&auto=format&fit=crop', 'description': 'Visualizes localized temporal shifts and predicts short-term outcomes.', 'price': 2999.00},
    {'id': 104, 'name': 'Neural Interface', 'category': 'Compute', 'image_url': 'https://images.unsplash.com/photo-1555949963-ff9fe0c870eb?q=80&w=800&auto=format&fit=crop', 'description': 'Direct connection hardware for enhanced data throughput and cognitive acceleration.', 'price': 1850.00},
    {'id': 105, 'name': 'Flux Capacitor', 'category': 'Power', 'image_url': 'https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=800&auto=format&fit=crop', 'description': 'Modular component for stabilizing high-energy transfers and optimizing flow.', 'price': 950.00},
    {'id': 106, 'name': 'Tactical Cloak', 'category': 'Wearables', 'image_url': 'https://images.unsplash.com/photo-1557180295-76eee20ae8aa?q=80&w=800&auto=format&fit=crop', 'description': 'Lightâ€‘refracting field generator for momentary visual concealment.', 'price': 4500.00},
] %}

                {% for product in products %}
                <div class="product-card bg-dark-card/80 backdrop-blur-sm border border-corp-primary/20 rounded-2xl p-6 shadow-xl transition-transform duration-300 hover:shadow-corp-primary/40 flex flex-col">
                    <div class="mb-4 overflow-hidden rounded-xl border border-corp-primary/20">
    <img src="{{ product.image_url }}" alt="{{ product.name }}" class="w-full h-40 object-cover"/>
</div>
                    
                    <h3 class="text-2xl font-bold text-gray-50 mb-2">{{ product.name }}</h3>
                    <p class="text-gray-400 text-sm mb-4">Product Ref: #{{ product.id }}</p> 
                    <p class="text-gray-300 flex-grow mb-4">{{ product.description }}</p>
                    
                    <div class="flex justify-between items-center mt-auto pt-4 border-t border-gray-700">
                        <span class="text-3xl font-extrabold text-corp-primary">${{ "%.2f"|format(product.price) }}</span>
                        
                        <!-- The single element that carries the data-id -->
                        <button 
                            class="add-to-cart bg-corp-secondary hover:bg-corp-primary text-gray-900 font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-xl shadow-corp-secondary/40 hover:shadow-corp-primary/50 focus:outline-none focus:ring-4 focus:ring-corp-secondary/50"
                            data-id="{{ product.id }}"
                        >
                            View Details
                        </button>
                    </div>
                </div>
                {% endfor %}
            </section>
        </div>

        <!-- BOTTOM ROW: IDE Output Panel (Full Width) -->
        <div class="mt-8">
            <div class="bg-dark-card border border-gray-700 rounded-xl shadow-2xl p-4">
                <h3 class="text-lg font-semibold text-corp-primary mb-4">
                    IDE Event Output
                </h3>
                
                <!-- Tab Buttons -->
                <div class="flex space-x-2 mb-4 text-sm font-medium">
                    <button data-tab="js" class="tab-button bg-gray-700/50 text-gray-300 py-1 px-3 rounded-full hover:bg-corp-primary/70 transition duration-200 tab-active">
                        JavaScript Event
                    </button>
                    <button data-tab="dom" class="tab-button bg-gray-700/50 text-gray-300 py-1 px-3 rounded-full hover:bg-corp-primary/70 transition duration-200">
                        DOM Context
                    </button>
                    <button data-tab="sql" class="tab-button bg-gray-700/50 text-gray-300 py-1 px-3 rounded-full hover:bg-corp-primary/70 transition duration-200">
                        SQL Preview
                    </button>
                </div>

                <!-- Code Output Displays -->
                <pre id="output-js" class="code-output p-3 rounded-md text-sm transition-opacity" style="--code-border-color: #00FFFF;">Click a product button to see the event details.</pre>
                <pre id="output-dom" class="code-output p-3 rounded-md text-sm hidden transition-opacity" style="--code-border-color: #64ffda;">DOM context data will appear here.</pre>
                <pre id="output-sql" class="code-output p-3 rounded-md text-sm hidden transition-opacity" style="--code-border-color: #f87171;">SQL dry run parameters will appear here.</pre>
                
                <p class="text-xs text-gray-500 mt-2">
                    *Displays client-side event data when a product is clicked.
                </p>
            </div>
        </div>

        <!-- Output Panel (Used for Server Confirmation) -->
        <div id="output-panel" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center hidden" onclick="hidePanel()">
            <div class="bg-dark-card p-8 rounded-xl shadow-2xl max-w-lg w-full mx-4 border border-corp-primary/50" onclick="event.stopPropagation()">
                <h4 class="text-xl font-bold mb-4 text-corp-primary">Server Response Confirmation</h4>
                <pre id="output-content" class="bg-code-bg text-gray-300 p-4 rounded-lg overflow-auto text-sm max-h-[70vh] border border-gray-700"></pre>
                <button onclick="hidePanel()" class="mt-4 w-full bg-corp-secondary hover:bg-corp-primary text-gray-900 font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-lg">Acknowledge & Close</button>
            </div>
        </div>
    </main>

    <!-- Client-side Scripting -->
    <script>
        // --- Output Panel & Debugging Setup ---
        const outputPanel = document.getElementById('output-panel');
        const outputContent = document.getElementById('output-content');
        const outputJs = document.getElementById('output-js');
        const outputDom = document.getElementById('output-dom');
        const outputSql = document.getElementById('output-sql');
        const tabButtons = document.querySelectorAll('.tab-button');
        
        // Hide/Show modal
        function showPanel() { outputPanel.classList.remove('hidden'); }
        function hidePanel() { outputPanel.classList.add('hidden'); }
        
        // Tab switching logic for IDE output
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Deactivate all
                tabButtons.forEach(btn => {
                    btn.classList.remove('tab-active', 'bg-corp-primary/70');
                    btn.classList.add('bg-gray-700/50');
                });

                [outputJs, outputDom, outputSql].forEach(el => el.classList.add('hidden'));

                // Activate selected
                const target = button.dataset.tab;
                button.classList.remove('bg-gray-700/50');
                button.classList.add('tab-active');
                document.getElementById('output-' + target).classList.remove('hidden');
            });
        });

        // Mock functions simulating server/runtime actions
        function runDomInline() { 
            return {
                contextNode: 'div.bg-dark-card',
                attributes: ['data-id', 'class'],
                timestamp: new Date().toISOString()
            };
        }
        function previewSqlInline(data) { 
             return new Promise(resolve => setTimeout(() => resolve({ 
                dryRun: true, 
                params: data, 
                query: `SELECT name, price, description FROM products WHERE id = :product_id`,
                message: 'Query parameters validated successfully.'
             }), 50)); // Short delay for realism
        }

        // --- Three.js Simulation Setup (Updated for Wireframe Network) ---
        let scene, camera, renderer, object;
        const container = document.getElementById('simulation-container');

        function initSimulation() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000a1a); // Very dark background for the sim

            // Camera setup
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 3;

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Create a complex, wireframe network sphere
            const geometry = new THREE.IcosahedronGeometry(1.5, 1);
            
            // Edges Geometry for the actual wireframe lines
            const edges = new THREE.EdgesGeometry(geometry);
            object = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ 
                color: 0x00FFFF, // Vibrant Teal
                linewidth: 2,
                opacity: 0.8,
                transparent: true
            }));

            scene.add(object);

            // Add subtle light for a bit of ambience, though the wireframe doesn't need it
            const ambientLight = new THREE.AmbientLight(0x00FFFF, 0.5); 
            scene.add(ambientLight);

            // Handle resize
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            // Rotation animation
            object.rotation.x += 0.001;
            object.rotation.y += 0.005;
            object.rotation.z += 0.002;

            renderer.render(scene, camera);
        }
        
        // Initialize the simulation only when the page is fully loaded
        window.onload = function() {
            // Ensure the container is available before initializing
            if (document.getElementById('simulation-container')) {
                initSimulation();
                animate();
            }
        };

        // ===================== PRODUCT CLICK HANDLER =====================
        document.addEventListener('click', async (e) => {
            const btn = e.target.closest('button.add-to-cart[data-id]');
            
            if (!btn) return;
            
            const productId = btn.dataset.id;

            // 1. Get IDE Output Data
            const domRes = runDomInline();
            let sqlPrev = await previewSqlInline({ product_id: Number(productId) });
            
            // The JavaScript event data (mocked code)
            const jsEvent = {
                event: 'click',
                targetClass: 'add-to-cart',
                dataId: productId,
                action: 'fetch(/add-to-cart, POST)'
            };

            // 2. Update IDE Output Panel
            outputJs.textContent = JSON.stringify(jsEvent, null, 2);
            outputDom.textContent = JSON.stringify(domRes, null, 2);
            outputSql.textContent = JSON.stringify(sqlPrev, null, 2);

            // Ensure the JS tab is active on click
            tabButtons.forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('bg-gray-700/50');
            });
            document.querySelector('[data-tab="js"]').classList.remove('bg-gray-700/50');
            document.querySelector('[data-tab="js"]').classList.add('tab-active');

            [outputJs, outputDom, outputSql].forEach(el => el.classList.add('hidden'));
            outputJs.classList.remove('hidden');


            // 3. Simulated API Call (Hitting the Flask route)
            let cartResp = null;
            try {
                // This is the live fetch call to the server route
                const r=await fetch('/add-to-cart',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body: JSON.stringify({ product_id:productId, quantity:1 })
                });

                const ct = r.headers.get('content-type')||'';
                cartResp = ct.includes('application/json') ? await r.json()
                                                            : { status:r.status, text:(await r.text()).slice(0,400) };
                
            } catch (err) { 
                cartResp = { error: String(err) }; 
            }

            // 4. Display results in the central modal panel
            showPanel();
            outputContent.textContent = JSON.stringify({
                '1. Server Call Success': cartResp.success || false,
                '2. Product ID Processed': productId,
                '3. Server Message': cartResp.message || cartResp.error,
                '4. Full Server Response': cartResp,
            }, null, 2);
        });

    
// 3D tilt hover for product cards (no libs)
(function(){
  var cards=document.querySelectorAll('.product-card');
  cards.forEach(function(el){
    el.addEventListener('mousemove',function(e){var r=el.getBoundingClientRect();var x=(e.clientX-r.left)/r.width-.5;var y=(e.clientY-r.top)/r.height-.5;el.style.transform='rotateY('+(x*9)+'deg) rotateX('+(-y*9)+'deg)';});
    el.addEventListener('mouseleave',function(){el.style.transform='rotateY(0) rotateX(0)';});
  });
})();
</script>
</body>
</html>
