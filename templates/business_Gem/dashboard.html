{% extends 'business_Gem/base.html' %}
{% block content %}
<!--
  Dashboard UI polish with inline Tailwind classes only.
  Notes:
  - Keeps all Jinja URLs/variables and DOM ids used by your JS.
  - No layout sections removed; only visual/style tweaks + spacing.
-->
<div class="min-h-screen bg-gradient-to-b from-[#e8eefc] via-[#eaf2ff] to-white py-12 px-6 mt-24 mb-24">
  <div class="max-w-7xl mx-auto rounded-2xl shadow-xl ring-1 ring-indigo-100/60 bg-white/90 backdrop-blur">
    <!-- Header -->
    <div class="relative flex items-center justify-between px-6 pt-6 pb-4 bg-[#a7bcb9] backdrop-blur border-2 border-[blue] rounded-t-2xl ring-1 ring-indigo-100/70 shadow-sm">
      <!-- Title with hover underline + subtle highlight -->
      <h1 class="text-3xl font-extrabold tracking-tight text-[#0000FF] drop-shadow-sm decoration-4 decoration-indigo-400 underline-offset-[10px] hover:underline transition">
        Dashboard
      </h1>

      <!-- User profile button with hover glow + pulse -->
      <div class="relative inline-block text-left mb-44">
        <button onclick="toggleDropdown()" class="flex items-center gap-2 px-3 py-2 rounded-2xl bg-white/80 hover:bg-white shadow-sm ring-1 ring-indigo-100 hover:ring-2 hover:ring-indigo-300/80 transition">
          <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="User" class="w-10 h-10 rounded-full ring-1 ring-indigo-200 hover:ring-indigo-400 hover:shadow-lg hover:animate-pulse transition"/>
          <svg class="w-8 h-8 text-indigo-700 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <!-- Dropdown menu -->
        <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white/95 backdrop-blur shadow-xl rounded-2xl border border-indigo-100 text-sm text-indigo-900 z-50 overflow-hidden">
          <div class="px-4 py-2 text-[13px] text-slate-500 bg-[#A3C1AD]">Profile Actions</div>
          <a href="/static/sample_products.csv" download class="block px-4 py-2 hover:bg-indigo-50 hover:underline underline-offset-4">Sample CSV</a>
          <a href="/static/sample_products.xlsx" download class="block px-4 py-2 hover:bg-indigo-50 hover:underline underline-offset-4">Sample Excel</a>
          <label for="fileUploadInput" class="block px-4 py-2 hover:bg-indigo-50 cursor-pointer hover:underline underline-offset-4">Upload File</label>
          <div class="border-t border-indigo-100 my-1"></div>
          <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-rose-600 hover:bg-rose-50 hover:underline underline-offset-4">Logout</a>
        </div>
      </div>

      <!-- Decorative gradient underline behind header -->
      <div class="absolute -bottom-[1px] left-0 right-0 h-[3px] bg-gradient-to-r from-transparent via-indigo-300 to-transparent"></div>
    </div>

    <!-- Hidden upload form (unchanged) -->
    <form id="fileUploadForm" action="/upload" method="POST" enctype="multipart/form-data" class="hidden">
      <input type="file" id="fileUploadInput" name="file" onchange="document.getElementById('fileUploadForm').submit();">
    </form>

    <!-- Secondary underline to visually separate dashboard content -->
    <div class="h-px bg-gradient-to-r from-indigo-100 via-indigo-200 to-indigo-100 mx-6 mt-2 rounded-full"></div>

    <!-- Small helper note under header (optional visual) -->
    <div class="px-6 pt-2 text-[12px] text-slate-500">Tip: Click the avatar to open profile actions.</div>

    <!-- Hidden upload form (unchanged) -->
    <form id="fileUploadForm" action="/upload" method="POST" enctype="multipart/form-data" class="hidden">
      <input type="file" id="fileUploadInput" name="file" onchange="document.getElementById('fileUploadForm').submit();">
    </form>


    <!-- Seller welcome + primary toggle -->
    <div class="px-6 mt-6">
      {% if session.get('user') and session['user']['role'] == 'seller' %}
      <button onclick="toggleChart()" class="mb-6 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white font-medium shadow hover:bg-indigo-700 transition">
        Toggle Sales Graph
      </button>
      <div id="salesChart" class="hidden bg-white shadow rounded-2xl p-4 ring-1 ring-indigo-50">
        <canvas id="chartCanvas" height="100"></canvas>
      </div>

      <div class="mt-6 mb-6">
        <h2 class="text-lg font-semibold text-indigo-900">Welcome, {{ session['user']['shop_name'] }}</h2>
        <p class="text-sm text-slate-600">Location: {{ session['user']['location'] }}</p>
      </div>
      {% endif %}
    </div>

    <!-- Public sales toggle (kept as-is; styled) -->
    <div id="salesWrap" class="px-6 mt-4 max-w-4xl">
      <button onclick="toggleChart()" class="mb-6 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-[#2E38F5] text-white font-medium shadow hover:bg-[#9140F4] transition">
        Toggle Sales Graph
      </button>
      <div id="salesChart" class="hidden bg-white shadow rounded-2xl p-4 ring-1 ring-indigo-50">
        <canvas id="chartCanvas" height="100"></canvas>
      </div>
    </div>

    <!-- Cards grid -->
    <div id="dynamic-events" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 px-6 pb-10 mt-10">
      <!-- Card 1 -->
      <div class="bg-gradient-to-br from-indigo-50 to-blue-50 p-5 rounded-2xl shadow-md hover:shadow-lg ring-1 ring-indigo-100 transition">
        <h3 class="text-lg font-semibold text-indigo-900">Top Product</h3>
        <img src="https://www.latelita.com/cdn/shop/articles/the-ruby-gemstone-everything-you-ever-needed-to-know-about-rubies-748231.jpg?v=1692710601&width=2048" alt="ruby" class="mt-3 w-full h-44 object-cover rounded-xl ring-1 ring-indigo-100">
        <p class="text-slate-600 text-sm mt-2">High-performance gemstone.</p>
      </div>
      <!-- Card 2 -->
      <div class="bg-gradient-to-br from-emerald-50 to-lime-50 p-5 rounded-2xl shadow-md hover:shadow-lg ring-1 ring-emerald-100 transition">
        <h3 class="text-lg font-semibold text-emerald-900">Top Seller</h3>
        <img src="https://imgix.starlanka.com/static/Pn1zhBMV-Untitled-1.jpg?auto=compress&fit=scale&fm=pjpg&h=630&w=840" alt="Paul Jewelers LTD" class="mt-3 w-full h-44 object-cover rounded-xl ring-1 ring-emerald-100">
        <p class="text-slate-600 text-sm mt-2">Paul Jewelers LTD</p>
      </div>
      <!-- Card 3 -->
      <div class="bg-gradient-to-br from-rose-50 to-pink-50 p-5 rounded-2xl shadow-md hover:shadow-lg ring-1 ring-rose-100 transition">
        <h3 class="text-lg font-semibold text-rose-900">New Orders</h3>
        <img src="https://www.pinnaclediamonds.net/sites/pinnaclediamonds.indiemade.com/files/imagecache/im_clientsite_product_zoom/P-019-253586482-1.jpg" alt="pending products" class="mt-3 w-full h-44 object-cover rounded-xl ring-1 ring-rose-100">
        <p class="text-slate-600 text-sm mt-2">23 pending shipments products</p>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Toggle chart visibility
  function toggleChart() {
    const chartSection = document.getElementById("salesChart");
    chartSection.classList.toggle("hidden");
  }
  // Toggle user dropdown
  function toggleDropdown() {
    document.getElementById('userDropdown').classList.toggle('hidden');
  }
  // Chart init (kept ids)
  const ctx = document.getElementById('chartCanvas')?.getContext('2d');
  if (ctx) {
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
          label: 'Sales ($)',
          data: [200, 400, 300, 600, 500, 700],
          borderColor: '#4F46E5',
          backgroundColor: 'rgba(79, 70, 229, 0.18)',
          tension: 0.4,
          fill: true,
          pointRadius: 4,
          pointHoverRadius: 7,
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#1f2361' } } },
        scales: {
          x: { grid: { display: false }, title: { display: true, text: 'Month', color: '#334155' }, ticks: { color: '#334155' } },
          y: { title: { display: true, text: 'Revenue', color: '#334155' }, ticks: { color: '#334155' } }
        }
      }
    });
  }
</script>
{% endblock %}
